<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>基于Qt实现的可视化地铁换乘系统 | 大聪明de小妙招</title><meta name="author" content="大聪明"><meta name="copyright" content="大聪明"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="基于Qt实现的可视化地铁换乘系统 	                  	             	         	     	  前言 这是大二头一学期的时候的C++大作业，要求是写2000行，觉得地铁换乘很好玩遂实现一下，主要的代码量还是在Qt里面，尤其是布局位置这一类的，当">
<meta property="og:type" content="article">
<meta property="og:title" content="基于Qt实现的可视化地铁换乘系统">
<meta property="og:url" content="http://lankoestee.github.io/posts/d1710c34/index.html">
<meta property="og:site_name" content="大聪明de小妙招">
<meta property="og:description" content="基于Qt实现的可视化地铁换乘系统 	                  	             	         	     	  前言 这是大二头一学期的时候的C++大作业，要求是写2000行，觉得地铁换乘很好玩遂实现一下，主要的代码量还是在Qt里面，尤其是布局位置这一类的，当">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://lankoestee.github.io/asset/logo.png">
<meta property="article:published_time" content="2024-03-19T08:55:19.000Z">
<meta property="article:modified_time" content="2024-03-23T08:05:20.924Z">
<meta property="article:author" content="大聪明">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Qt">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://lankoestee.github.io/asset/logo.png"><link rel="shortcut icon" href="/asset/logo.png"><link rel="canonical" href="http://lankoestee.github.io/posts/d1710c34/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="U9WhEJQBAv2XcvaMvJP3Uuk57bdg4yA_pFIM-7Flffc"/><meta name="baidu-site-verification" content="codeva-eFSN0WMF8D"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?aeaa3010575bb5a126b4f516e698a2a7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '基于Qt实现的可视化地铁换乘系统',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-23 16:05:20'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/asset/logo.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: linear-gradient(10deg, #f0c27b, #4b1248)"><nav id="nav"><span id="blog-info"><a href="/" title="大聪明de小妙招"><span class="site-name">大聪明de小妙招</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">基于Qt实现的可视化地铁换乘系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-03-19T08:55:19.000Z" title="发表于 2024-03-19 16:55:19">2024-03-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-23T08:05:20.924Z" title="更新于 2024-03-23 16:05:20">2024-03-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AF%BE%E7%A8%8B%E4%BD%9C%E4%B8%9A/">课程作业</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4k</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="基于Qt实现的可视化地铁换乘系统"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><table  border="2" >
	<tr>
	    <td bgcolor=#F0F0F0>
	        <center>
	            <b>
	                <font color=#E0545D size="6">
						基于Qt实现的可视化地铁换乘系统
	                </font> 
	            </b>
	        </center>
	    </td>
	</tr>
</table>
<h2 id="前言">前言</h2>
<p>这是大二头一学期的时候的C++大作业，要求是写2000行，觉得地铁换乘很好玩遂实现一下，主要的代码量还是在Qt里面，尤其是布局位置这一类的，当然底层的算法也是写了不少的。</p>
<p>当然大二的水平实在有限，当时配Qt没有留下来一个完整操作流程。</p>
<p>如果要看最后的效果，请跳转<a href="#%E6%9C%80%E7%BB%88%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA">最终成果展示</a></p>
<p>全部代码发布在了<a target="_blank" rel="noopener" href="https://github.com/lankoestee/MetroSearch">lankoestee/MetroSearch</a>上，但由于C++与Qt的环境配置过于困难了，故没有安装使用方法，不过所有的文件都在上面了。</p>
<h2 id="系统功能介绍">系统功能介绍</h2>
<p>本系统是基于Qt5.9实现的可视化地铁换乘系统，可以通过可视化控件的点按或滑动形式，实现全国各城市的地铁换乘线路指引，帮助异地者更加方便地换乘地铁线路。进入页面后，可以通过下拉选项框的方式选择城市、起点线路、起点站、终点线路、终点站，并通过查询按钮，点击查询地铁乘坐路线。初始页面如图1所示。</p>
<p><img src="/asset/%E5%9F%BA%E4%BA%8EQt%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9C%B0%E9%93%81%E6%8D%A2%E4%B9%98%E7%B3%BB%E7%BB%9F/%E5%88%9D%E5%A7%8B%E7%95%8C%E9%9D%A2.png" alt="图1"></p>
<p>在初始界面选择相应的信息并点击“查询”按钮后，如图2所示的图形化的换乘界面便会显示在右边的空位处。在图形化换乘界面中，通过纵向排列换乘方案的方式，清楚地标明了起点站、终点站、换乘站、乘坐线路、乘坐方向、乘坐站数和线路标识色等信息，方便使用者记忆路线。同时，点击“切换地图显示模式”按钮，如图3所示地图界面便会显示在右方、替代图形化换乘界面。地图界面以线路标识色绘制了换乘路径在地图上的显示，并以灰色线条绘制了乘坐路径周围的地铁线路。将鼠标放置在途径站点上，会在鼠标右侧显示站点名称，通过线路等相关信息，更为具体地展现了乘坐路径。</p>
<p><img src="/asset/%E5%9F%BA%E4%BA%8EQt%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9C%B0%E9%93%81%E6%8D%A2%E4%B9%98%E7%B3%BB%E7%BB%9F/route%E7%BB%98%E5%9B%BE%E6%A8%A1%E5%BC%8F.png" alt="图2"></p>
<p><img src="/asset/%E5%9F%BA%E4%BA%8EQt%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9C%B0%E9%93%81%E6%8D%A2%E4%B9%98%E7%B3%BB%E7%BB%9F/map%E7%BB%98%E5%9B%BE%E6%A8%A1%E5%BC%8F.png" alt="图3"></p>
<p>除此之外，系统还提供了许多额外功能。为更方便地了解线路走向，选择<strong>显示线路</strong>后点击“显示线路”按钮，便可在右方实现线路整体走向的显示，其显示风格与地图显示模式相同；通过下拉框选择<strong>历史记录</strong>后，点击“应用”按钮，便可将下拉框的历史记录成为当前的起点与终点，随后点击“查询”，可以快捷地回访历史路径；若想进行地铁图的<strong>更新</strong>，点击“更新”按钮，根据消息框的提示，在联网的情况下等待15秒左右，系统将自动更新至最新版本的线路图；在查询路线的过程中，可以通过拖动两个滑块，实现<strong>个性化换乘方案</strong>的选择，根据要求实现不同换乘方案。其具体操作流程如图4所示。</p>
<p><img src="/asset/%E5%9F%BA%E4%BA%8EQt%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9C%B0%E9%93%81%E6%8D%A2%E4%B9%98%E7%B3%BB%E7%BB%9F/%E8%AE%BE%E8%AE%A1%E6%80%9D%E7%BB%B4%E5%9B%BE.png" alt="图4"></p>
<h2 id="功能实现思路">功能实现思路</h2>
<h3 id="实现工具选择">实现工具选择</h3>
<p>在功能的实现过程中，选择了Qt5对上述功能进行实现。Qt是一个大型的跨平台C++应用程序开发框架，被广泛的用于应用程序GUI的开发。在选择方面，同样可以通过<code>#include&lt;windows.h&gt;</code>来进行应用程序的开发，但相较windows.h而言，Qt的开发流程更为简洁，控件的布局设置更为直观，同时支持更为复杂的操作和图形化编程。因此，在地铁换乘程序的开发上，最终选择使用Qt对其进行实现。</p>
<p>而在使用Qt的过程中，受限于电脑性能，图形化编程功能在自带的Qt Creator编辑器中响应较慢，同时由于Qt Creator不美观的操作界面和较复杂的类生成方式，在编辑器的选择方面，最终选择通过安装插件的方式在Visual Studio上进行功能的实现，同时放弃图形化的编程方式，通过自编代码的初始化和参数改变生成响应的控件和部件。</p>
<h3 id="图形界面初始化">图形界面初始化</h3>
<p>在确定使用Qt进行非图形化编程后，可以采用Qt自带的多种控件和其完备的功能函数对图形界面进行初始化，包括按钮QPushButton、下拉框QComboBox、标签QLabel等多种功能函数对界面进行初始化。在本程序中，窗口被设定为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1600</mn><mo>×</mo><mn>900</mn></mrow><annotation encoding="application/x-tex">1600\times 900</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1600</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">900</span></span></span></span>的大小，这与大多数显示器的显示比例相差无几，同时其分辨率不会超出如今大部分的电脑的屏幕分辨率。在这样的窗口大小下，直接通过每个实体控件均有的setGrometry函数对其进行位置编辑，其中一个重载函数接收左上角横坐标、左上角纵坐标、横向距离、纵向距离四个参数确定控件具体位置。</p>
<p>在图形的绘制方面，Qt提供了画家类QPainter以供绘制图形，通过对QPen，QBrush类创建、修改对象和应用，可以通过其绘制多种图形，以提供可视化解决方案。</p>
<h3 id="线路数据获取与更新">线路数据获取与更新</h3>
<p>为实现该系统在全国范围内的通用，在数据文档的生成方面，不能仅仅通过手动输入编写信息，这会带来巨额的工作量，通过代码的实现，可以直接从网络中爬取所需的相应数据。在爬取数据方面，C++提供了相应的库以完成爬取任务，然而相较于Python，其劣势也是明显的。Python语言在数据爬取方面拥有更好的封装，能够以更加简介的代码完成同样的任务，是目前主流的数据爬取工具。但其仍有缺点，即与计算机较慢的交互速度，这会增加其爬取时间。在本程序中，数据的获取是由Python语言文件进行实现的。</p>
<p>在爬取对象的确定方面，可以通过百度地图、高德地图等地图软件获取地铁线路站点数据，而由于百度地图网页代码并不开源，因此选择了高德地图作为数据的来源。在锁定<a target="_blank" rel="noopener" href="http://map.amap.com/subway/">高德地图地铁图</a>功能网站后，通过解析其中json文件代码，可以从中得到需要的数据，选择了其中一部分进行储存，包括线路名称、线路标志色、站点名称、站点经纬度等。由于网站数据存在一定问题和不明晰，如连续出现两个站点、地铁主线和支线没有区分等不利于后续实现的问题存在，还需在Python文件中对错误数据进行满足程序需求的改良，最终形成各个城市的地铁数据文件，并以csv文件的形式为每个城市保存了一个文件。</p>
<p>更新方面，可以通过<code>#include&quot;Python.h&quot;</code>，引入该头文件，实现在C++程序中执行Python程序。在本程序中，更新功能是通过执行Python程序，重新获取全部数据实现的。</p>
<h3 id="类的设置与定义">类的设置与定义</h3>
<p>若需实现根据站点搜寻路径的功能，建立类是一个很好的形式。在本程序中，建立了线路类Line和站点类Station两个类，其中Station类继承自Line类。对于线路类，需要明晰其线路名称、线路标识色、环线与否等情况，将这些要素设为了保护性数据成员，以便Staiton类使用。若要使用两者之间的继承关系，则需满足一个站点仅对应一条线路的情形，大部分站点均是满足这个条件的，而换乘站却是例外，故将换乘站是为多个不同线路上重名的几个站点。</p>
<p>Station类继承自Line类，但其仍然拥有其独特的数据成员，分别是站点编号、站点名称、站点经纬度、和连接站点。对于每一个数据成员，都采用设置函数的方式方便读取私有或保护性数据成员。其UML类图如图5所示。</p>
<p><img src="/asset/%E5%9F%BA%E4%BA%8EQt%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9C%B0%E9%93%81%E6%8D%A2%E4%B9%98%E7%B3%BB%E7%BB%9F/UML%E7%B1%BB%E5%9B%BE.png" alt="图5"></p>
<p>为实现换乘路径的搜寻，由于穷举法的不切实际性，必须采用构建网络（图）的形式以搜寻最佳路径。在网络的构建方面，选择采用邻接表的形式进行构建，即创立了新的数据结构Adjacent，其定义如下。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Adjacent</span> &#123;</span><br><span class="line">	<span class="type">int</span> adjacentId;</span><br><span class="line">	<span class="type">double</span> spacing;</span><br><span class="line">	Adjacent* next;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在Adjacent中，adjacentId用以表示邻接站点ID，spacing用以表示相邻站点距离（换乘站点距离为0），next则表示该站点的下一个邻接站点，若已表示了该站点的所有邻接站点，则将其设为空指针NULL。邻接表的赋值过程，即为地铁网络的构建过程。在为每一个站点赋值邻接表时、需要进行如下的操作：</p>
<ol>
<li>连接同一线路相邻的两站，互相将站点ID写入对方邻接表中，通过两站的经纬度信息，计算相隔距离spacing，将其作为Adjacent指针写入站点邻接表的末尾；</li>
<li>遍历除本站外所有站点，寻找同名、同经度、同纬度的站点，将该站ID写入本站邻接表末尾中，其中相隔距离设置为0，以判断该站为换乘站。</li>
</ol>
<p>通过上述的两步操作，便可在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>的时间复杂度内填充每个站点的邻接表，构建城市地铁网络。在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>时间复杂度下，该步骤运行时间极短。在打开程序时，程序默认以北京作为初始化城市，当城市选择复选框发生改变时，便会清楚原有数据，对新的选定城市进行初始化。</p>
<h3 id="最短路径的搜寻">最短路径的搜寻</h3>
<p>如今的图最短路径算法众多，最为常见的算法是广度优先搜索算法（Breadth First Search，简称BFS）其时间复杂度仅为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi mathvariant="normal">∣</mi><mi>V</mi><mi mathvariant="normal">∣</mi><mo>+</mo><mi mathvariant="normal">∣</mi><mi>E</mi><mi mathvariant="normal">∣</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(|V|+|E|)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord">∣</span><span class="mclose">)</span></span></span></span>，能够较快的完成无权图的最短路径搜寻。而由于站点之间的距离存在，地铁网络可被视为一个有权图，BFS算法在有权图中的实现稍显复杂，故于此，选择使用迪杰斯特拉算法（Dijkstra’s Algorithm）是实现该无向带权图的单源最短路径搜寻。</p>
<p>迪杰斯特拉算法通过维护两个数组dist和pi进行单源最短路径的搜寻。其中dist值数组代表的是各个点到起点的最短路径长度，pi数组代表所有未求得最短路径的点到起点的局部最短路径长度。通过不断在pi数组中寻找最小值，赋入dist数组，并重新更新所有点的pi值，可以实现单源点到联通图中任一一点的距离。迪杰斯特拉算法的时间复杂度高于BFS，为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi mathvariant="normal">∣</mi><mi>V</mi><msup><mi mathvariant="normal">∣</mi><mn>2</mn></msup><mo>+</mo><mi mathvariant="normal">∣</mi><mi>E</mi><mi mathvariant="normal">∣</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(|V|^2+|E|)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord">∣</span><span class="mclose">)</span></span></span></span>，但在实际使用中，其复杂度不会产生任何延迟。</p>
<p>在站点的更新方面，不仅只将两站点之间距离distance作为唯一的判断标准，而是引入了换乘代价和途径站点代价两种不同的代价，将其以距离的形式表示，作为添加进入最短距离的计算中去。这两种代价可以通过滑动初始页面中的滑块进行自定义设置，为路径的搜寻提供了另外的可能。</p>
<p>在本程序中，由于要记录最短生成路径，创建并维护了一个updater数组，用以记录是何站点路径的确定引起了本站点pi值的改变，即是谁减小了本站点的pi值。除了起点站外，连通网中每个站点都拥有一个updater，用以表示从起点站到该站点的最短路径中，该站点的上一站是谁。可以使用标准模板库中的栈<code>std::stack</code>以储存站点数据。从终点站开始，依次对上一站点的updater进行进栈操作。直至进栈至起点站，便得到了一个以起点站为栈顶，终点站为栈底的方案栈scheme。这便产生了其最短路径，为下一步的处理奠定了基础。</p>
<h3 id="可视化图形的绘制">可视化图形的绘制</h3>
<p>可视化图形的绘制，主要是通过重写Qt中自带的paintEvent函数进行图形的绘制，paintEvent函数无需通过槽函数进行调用，而是可以在每次页面内容存在改变时自动调用，同时可以通过Qt自带的update()函数进行手动调用。</p>
<p>对于图2所示的路径绘图模式而言，其绘制的主要依靠是最短路径搜寻所得到的方案栈scheme，通过对其进行出栈操作。判断其是否为换乘站，并对途径站和换乘站绘制可视化图形进行表示，同时提取站点所在线路的标识色，在文字显示之余能够通过颜色更加直观的显示出换乘方案，方便记忆。由于图形绘制细节繁多，这部分内容是本程序实现代码中最长的部分。</p>
<p>对于图3的地图绘制模式而言，其依然通过对方案栈scheme的使用进行地图的绘制。首先确定最优路径站点的经纬度信息，确定绘制的比例尺和绘制区域，其次通过遍历所有站点，将所有站点绘制出来，随后仍是使用方案栈路径，将最优线路用站点所属线路颜色标志出来，最后通过删除指定画布外围区域，实现在指定区域内以合适比例尺大小展示方案路线。</p>
<h3 id="历史记录提取与应用">历史记录提取与应用</h3>
<p>与读取城市文件应用到复选框中相同，历史记录同样以csv文件的形式保存在文件夹中。每次点击查询按钮，便会生成一条新的历史记录，并将其放至文件夹的头部，为防止数据量过大，若此时历史记录的条数超过20条时，便会自动删除最后一条的历史记录。通过fstream读取历史记录并以逗号分割，通过复选框函数setCurrentText，便可将历史记录自动应用至设置起始站点的复选框内。</p>
<h3 id="实现过程中所遇到的问题">实现过程中所遇到的问题</h3>
<p>使用Visual Studio实现Qt应用程序时，由于无法使用图形化编程，故各个控件只能通过多次调整位置的方式进行布放和实现，这样的布放较为严格地限制了窗口的大小，扩大和缩小窗口均有可能造成控件和图片位置的错乱。</p>
<p>由于本人电脑中所安装的Python是在x64平台上运行的，而非win32，这使得在建立解决方案的过程中，统一采用了x64平台进行编写与建立。又因为若将解决方案配置为debug模式，会导致release模式无法使用，故在程序编写和测试的过程中，统一采用了x64平台的release模式进行调试和发布。</p>
<h2 id="最终结果展示">最终结果展示</h2>
<p>附上了程序运行示例视频，以便更换电脑无法正确运行时使用。</p>
<p>本程序的主要实现均在<code>MetroSearch.cpp</code>文件中，其余代码可以参考其余文件。</p>
<p><img src="/asset/%E5%9F%BA%E4%BA%8EQt%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9C%B0%E9%93%81%E6%8D%A2%E4%B9%98%E7%B3%BB%E7%BB%9F/%E4%BD%BF%E7%94%A8%E6%BC%94%E7%A4%BA%E5%BD%95%E5%B1%8F.gif" alt=""></p>
<p><img src="/asset/%E5%9F%BA%E4%BA%8EQt%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9C%B0%E9%93%81%E6%8D%A2%E4%B9%98%E7%B3%BB%E7%BB%9F/%E5%A4%8D%E9%80%89%E6%A1%86%E6%8B%BC%E5%9B%BE.png" alt="图6"></p>
<p><img src="/asset/%E5%9F%BA%E4%BA%8EQt%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9C%B0%E9%93%81%E6%8D%A2%E4%B9%98%E7%B3%BB%E7%BB%9F/%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8B%BC%E5%9B%BE.png" alt="图7"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://lankoestee.github.io">大聪明</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://lankoestee.github.io/posts/d1710c34/">http://lankoestee.github.io/posts/d1710c34/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lankoestee.github.io" target="_blank">大聪明de小妙招</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C++</a><a class="post-meta__tags" href="/tags/Qt/">Qt</a><a class="post-meta__tags" href="/tags/Python/">Python</a></div><div class="post_share"><div class="social-share" data-image="/asset/logo.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/db0b4310/" title="计算机网络笔记"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">计算机网络笔记</div></div></a></div><div class="next-post pull-right"><a href="/posts/ea3353e6/" title="使用RRT规划及PD控制的ROS仿真小车竞速"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">使用RRT规划及PD控制的ROS仿真小车竞速</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/ea3353e6/" title="使用RRT规划及PD控制的ROS仿真小车竞速"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-19</div><div class="title">使用RRT规划及PD控制的ROS仿真小车竞速</div></div></a></div><div><a href="/posts/25ec247c/" title="苹果叶片病害多标签分类"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-11</div><div class="title">苹果叶片病害多标签分类</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/asset/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">大聪明</div><div class="author-info__description">还有小聪明的没放进来</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lankoestee"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">系统功能介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-number">3.</span> <span class="toc-text">功能实现思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%B7%A5%E5%85%B7%E9%80%89%E6%8B%A9"><span class="toc-number">3.1.</span> <span class="toc-text">实现工具选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.2.</span> <span class="toc-text">图形界面初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E8%B7%AF%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E4%B8%8E%E6%9B%B4%E6%96%B0"><span class="toc-number">3.3.</span> <span class="toc-text">线路数据获取与更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E8%AE%BE%E7%BD%AE%E4%B8%8E%E5%AE%9A%E4%B9%89"><span class="toc-number">3.4.</span> <span class="toc-text">类的设置与定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E7%9A%84%E6%90%9C%E5%AF%BB"><span class="toc-number">3.5.</span> <span class="toc-text">最短路径的搜寻</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9B%BE%E5%BD%A2%E7%9A%84%E7%BB%98%E5%88%B6"><span class="toc-number">3.6.</span> <span class="toc-text">可视化图形的绘制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E6%8F%90%E5%8F%96%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="toc-number">3.7.</span> <span class="toc-text">历史记录提取与应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B%E4%B8%AD%E6%89%80%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.8.</span> <span class="toc-text">实现过程中所遇到的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="toc-number">4.</span> <span class="toc-text">最终结果展示</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/b3b5b1c5/" title="基于JMAG的表贴式三项永磁同步电机仿真分析">基于JMAG的表贴式三项永磁同步电机仿真分析</a><time datetime="2024-03-30T01:07:51.000Z" title="发表于 2024-03-30 09:07:51">2024-03-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/db0b4310/" title="计算机网络笔记">计算机网络笔记</a><time datetime="2024-03-23T07:56:29.000Z" title="发表于 2024-03-23 15:56:29">2024-03-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/d1710c34/" title="基于Qt实现的可视化地铁换乘系统">基于Qt实现的可视化地铁换乘系统</a><time datetime="2024-03-19T08:55:19.000Z" title="发表于 2024-03-19 16:55:19">2024-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/ea3353e6/" title="使用RRT规划及PD控制的ROS仿真小车竞速">使用RRT规划及PD控制的ROS仿真小车竞速</a><time datetime="2024-03-19T01:43:48.000Z" title="发表于 2024-03-19 09:43:48">2024-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/f2223026/" title="MIT-6.824-2022-Lab3 &amp; Lab2D">MIT-6.824-2022-Lab3 &amp; Lab2D</a><time datetime="2024-03-18T01:40:35.000Z" title="发表于 2024-03-18 09:40:35">2024-03-18</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(180deg, #f0c27b, #4b1248)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 大聪明</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>